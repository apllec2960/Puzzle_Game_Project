<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<!-- fa-icon CDN -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<style>
	body{
		background-image: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
	}
	button{
		background-image: linear-gradient(to top, #feada6 0%, #f5efef 100%);
	}

</style>
<script src="/puzzle/scripts/jquery-3.4.1.min.js"></script>
</head>
<body class="container">
	<div align="center" class="mt-5 pt-3">
	
		<h1>Reverse Puzzle</h1>
		<h3><span id="loginState"></span>ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</h3>
		
		<table>
			<tr>
				<td>
					<!-- ë¡œê·¸ì¸ í›„ -->
					<button id ="gameBtn" class="btn">ğŸ’»ê²Œì„</button>
				</td>
				<td>
					<!-- ë¡œê·¸ì¸ ì „ -->
					<button id ="loginBtn" class="btn">ë¡œê·¸ì¸</button>
					<button id ="joinBtn" class="btn">íšŒì›ê°€ì…</button>
					<!-- ë¡œê·¸ì¸ í›„ -->
					<button id ="logoutBtn" class="btn">ë¡œê·¸ì•„ì›ƒ</button>
					<button id ="updateBtn" class="btn">ê°œì¸ì •ë³´ ìˆ˜ì •</button>
				<td>
			</tr>
		</table>
		<hr>
		
	
		<button id="totalBtn" class="btn ">ğŸ‘‘ top10</button>
		<button id="monthBtn" class="btn">ğŸ†ì´ë‹¬ì˜ top10</button>
		<button id="todayBtn" class="btn">ğŸ¥‡ì˜¤ëŠ˜ì˜ top10</button>
		<!-- ë¡œê·¸ì¸ í›„ -->
		<button id ="myRecordList" class="btn">â³ë‚´ ê¸°ë¡</button>
		<hr>
		
		<!--ìˆœìœ„ list ì¶œë ¥ -->
		<table  class="table container" id ="list">
		</table>
	
	</div>
	
</body>
<script>
function list(item){
	let html = "<tr>";
    html += "<td>"+item.memberId+"</td>";
    html += "<td>"+item.reportDate+"</td>";
    html += "<td>"+item.count+"</td>";
    html += "<td>"+item.timer+"</td>";
    html += "</tr>";
    $("#list").append(html);
}

$(document).ready(function(){
   // sessionInfoê°’ì„ ìš”ì²­ ë™ê¸°ìš”ì²­!
   let loginState = null;
   
   $.ajax({
	  url :"/puzzle/GetSessionInfo",
	  async : false, // ë™ê¸°ìš”ì²­
	  method : "POST",
	  success : function(json){
		loginState = json;
		console.log("sessionInfo : ", loginState);
	  }
   });	 
   
/*     //ë¡œê·¸ì¸ì´ ë˜ì—ˆë‚˜ ë¬»ëŠ”  
    if(loginState == null){
	   location.href = "/puzzle/login.html";
	   return false;
    }
 */    
 
   //ìƒë‹¨ì— ë¡œê·¸ì¸ idí‘œì‹œ
   $("#loginState").text(loginState);
  
   //ë¡œê·¸ì¸ì‹œ... ë¹„ë¡œê·¸ì¸ì‹œ..
   if(loginState == null){
	   $("#totalBtn").show();
	   $("#todayBtn").show();   
	   $("#MonthBtn").show();
	   $("#loginBtn").show();
	   $("#joinBtn").show();
	   $("#logoutBtn").hide();
	   $("#myRecordList").hide();
	   $("#gameBtn").hide();
	   $("#updateBtn").hide();
   }else{
	   $("#totalBtn").show();
	   $("#todayBtn").show();   
	   $("#MonthBtn").show();
	   $("#loginBtn").hide();
	   $("#joinBtn").hide();
	   $("#logoutBtn").show();
	   $("#myRecordList").show();
	   $("#gameBtn").show();
	   $("#updateBtn").show();
   }
   
	//ì „ì²´ íƒ‘10
   $.ajax({
       url: "/puzzle/SelectReportLimit",
       method: "POST",
       success : function(json){
          $("#list").empty();
         // console.log(json);
          $(json).each(function(index, item){
             list(item);
          })            
       }                           
    });
   
   
	//ì „ì²´ íƒ‘10 ë²„íŠ¼
	$("#totalBtn").click(function(){
	    $.ajax({
	         url: "/puzzle/SelectReportLimit",
	         method: "POST",
	         success : function(json){
	            $("#list").empty();
	           // console.log(json);
	            $(json).each(function(index, item){
	            	list(item);
	               
	            })            
	         }                           
	      }); 
	});
	//ì˜¤ëŠ˜ íƒ‘10 ë²„íŠ¼
	$("#todayBtn").click(function(){
	    $.ajax({
	         url: "/puzzle/SelectReportToday",
	         method: "POST",
	         success : function(json){
	            $("#list").empty();
	           // console.log(json);
	            $(json).each(function(index, item){
	            	list(item);
	            });       
	         }                    
	      }); 
	});
	//ì´ë²ˆë‹¬ íƒ‘10 ë²„íŠ¼
	$("#monthBtn").click(function(){
		$.ajax({
			url : "/puzzle/SelectReportMonth",
			method : "POST",
			success : function(json){
			$("#list").empty();
			console.log(json);
				$(json).each(function(index, item){
					list(item);
				});
			}	
	 	});
	});
	//ë‚˜ì˜ ê¸°ë¡ ë²„íŠ¼
	$("#myRecordList").click(function(){
		$.ajax({
			url : "/puzzle/SelectReportMyRec",
			method : "POST",
			data : {"ID" : loginState}, //ë°ì´í„°ê°’ ì…ë ¥.
			success : function(json){
				console.log(json);
				$("#list").empty();
				$(json).each(function(index, item){
					list(item);
				});
			}
		});
	});
	
	//ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™.
	$("#loginBtn").click(function(){
		location.href="/puzzle/login.html";
		return false
	});
	//íšŒì›ê°€ì… í˜ì´ì§€ ì´ë™
	$("#joinBtn").click(function(){
		location.href="/puzzle/join.html";
		return false
	});
	//ê²Œì„í•˜ê¸°
	$("#gameBtn").click(function(){
		location.href="/puzzle/puzzle.html";
		return false
	});
	//ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì •í˜ì´ì§€ ì´ë™.
	$("#updateBtn").click(function(){
		location.href="/puzzle/myPage.html";
		return false
	});
	 //ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
    $("#logoutBtn").click(function(){
       console.log("out");
       $.ajax({
            url :"/puzzle/Logout",
            method : "POST",
            success : function(json){
             console.log("sessionInfo : ", loginState);
             location.href = "/puzzle/login.html";
             return;
            }, 
            error: function() {
             alert("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
          },
          fail: function() {
             alert("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
          }
          });
    });
	
});
</script>
</html>